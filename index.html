<!--
  SocialExplorer.ml
  Copyright Â© 2019-2022 Blue Forest

  Repository: https://github.com/blue-forest/socialexplorer

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published
  by the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program. If not, see <https://www.gnu.org/licenses/>.
-->
<!DOCTYPE html>
<html>
<head>
  <title>SocialExplorer</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; width: 100%; display: flex; }
    nav { padding: 10px 20px; }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.15.15/dist/css/uikit.min.css"/>
  <script type="module">
    const instances = [/**/]
    const items = { accounts: {}, hashtags: {} }
    let ws
    function send(message) {
      const jsonMessage = JSON.stringify(message)
      if(typeof ws === "undefined") {
        ws = new WebSocket(`ws://${window.location.host}/api`)
        ws.onmessage = (event) => {
          const { domain, accounts, hashtags } = JSON.parse(event.data)
          for(const { id, ...account } of accounts) {
            if(typeof items.accounts[id] === "undefined") {
              items.accounts[id] = account
            }
          }
          for(const { name, url } of hashtags) {
            if(typeof items.hashtags[name] === "undefined") {
              items.hashtags[name] = []
            }
            items.hashtags[name].push(url)
          }
          console.log(items)
        }
        ws.onopen = () => ws.send(jsonMessage)
      } else {
        ws.send(jsonMessage)
      }
    }
    send({
      instances: instances.map(instance => instance.id),
      query: "mastodon",
      limit: 5,
    })
  </script>
  <script src="https://cdn.jsdelivr.net/npm/uikit@3.15.15/dist/js/uikit.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/uikit@3.15.15/dist/js/uikit-icons.min.js"></script>
</head>
<body>
  <nav class="uk-navbar-container" uk-navbar>
    <h4>SocialExplorer</h4>
  </nav>
  <main id="items">
  </main>
</body>
</html>
